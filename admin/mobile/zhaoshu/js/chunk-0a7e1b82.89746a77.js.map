{"version":3,"sources":["webpack:///./src/libs/imgPreview.js","webpack:///./src/view/cart/index.vue?9243","webpack:///src/view/cart/index.vue","webpack:///./src/view/cart/index.vue?fcd9","webpack:///./src/view/cart/index.vue","webpack:///./src/api/supervise.js"],"names":["imgPreview","file","Orientation","self","_this","console","log","Exif","getData","getTag","this","window","FileReader","test","type","reader","readAsDataURL","onloadend","result","img","Image","src","length","headerImage","postImg","onload","data","compress","render","_vm","_h","$createElement","_c","_self","staticStyle","position","top","attrs","on","change","subImg","staticRenderFns","cartvue_type_script_lang_js_","created","methods","e","Object","target","files","then","formData","FormData","append","supervise","res","catch","view_cartvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","__webpack_require__","d","getProjectList","getContractList","getTreeSupervise","getTreeSuperviseInfo","getTwoCodeInfo","postTreeInfo","getSuperviseStatus","postSuperviseInfo","postSuperviseImg","postSuperviseUnusual","bindPhone","_libs_api_request__WEBPACK_IMPORTED_MODULE_0__","_libs_util__WEBPACK_IMPORTED_MODULE_1__","getAxiosData","axios","request","url","method"],"mappings":"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","file":"js/chunk-0a7e1b82.89746a77.js","sourcesContent":["export const imgPreview = (file)=>{\r\n    let self = this;\r\n    let Orientation;\r\n    //去获取拍照时的信息，解决拍出来的照片旋转问题\r\n    console.log(\"=================\" + this.Exif);\r\n    Exif.getData(file, function () {\r\n        Orientation = Exif.getTag(this, 'Orientation');\r\n    });\r\n    // 看支持不支持FileReader \r\n    if (!file || !window.FileReader) return;\r\n\r\n    if (/^image/.test(file.type)) {\r\n        // 创建一个reader\r\n        let reader = new FileReader();\r\n        // 将图片2将转成 base64 格式\r\n        reader.readAsDataURL(file);\r\n        // 读取成功后的回调\r\n        reader.onloadend = function () {\r\n            let result = this.result;\r\n            let img = new Image();\r\n            img.src = result;\r\n            //判断图片是否大于100K,是就直接上传，反之压缩图片\r\n            if (this.result.length <= (100 * 1024)) {\r\n                self.headerImage = this.result;\r\n                self.postImg();\r\n            } else {\r\n                img.onload = function () {\r\n                    let data = self.compress(img, Orientation);\r\n                    self.headerImage = data;\r\n                    self.postImg();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction postImg() {\r\n    //这里写接口\r\n}\r\nfunction rotateImg(img, direction, canvas) {\r\n    //最小与最大旋转方向，图片旋转4次后回到原方向\r\n    const min_step = 0;\r\n    const max_step = 3;\r\n    if (img == null) return;\r\n    //img的高度和宽度不能在img元素隐藏后获取，否则会出错\r\n    let height = img.height;\r\n    let width = img.width;\r\n    let step = 2;\r\n    if (step == null) {\r\n        step = min_step;\r\n    }\r\n    if (direction == 'right') {\r\n        step++;\r\n        //旋转到原位置，即超过最大值\r\n        step > max_step && (step = min_step);\r\n    } else {\r\n        step--;\r\n        step < min_step && (step = max_step);\r\n    }\r\n    //旋转角度以弧度值为参数\r\n    let degree = step * 90 * Math.PI / 180;\r\n    let ctx = canvas.getContext('2d');\r\n    switch (step) {\r\n        case 0:\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            ctx.drawImage(img, 0, 0);\r\n            break;\r\n        case 1:\r\n            canvas.width = height;\r\n            canvas.height = width;\r\n            ctx.rotate(degree);\r\n            ctx.drawImage(img, 0, -height);\r\n            break;\r\n        case 2:\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            ctx.rotate(degree);\r\n            ctx.drawImage(img, -width, -height);\r\n            break;\r\n        case 3:\r\n            canvas.width = height;\r\n            canvas.height = width;\r\n            ctx.rotate(degree);\r\n            ctx.drawImage(img, -width, 0);\r\n            break;\r\n    }\r\n}\r\nfunction compress(img, Orientation) {\r\n    let canvas = document.createElement(\"canvas\");\r\n    let ctx = canvas.getContext('2d');\r\n    //瓦片canvas\r\n    let tCanvas = document.createElement(\"canvas\");\r\n    let tctx = tCanvas.getContext(\"2d\");\r\n    let initSize = img.src.length;\r\n    let width = img.width;\r\n    let height = img.height;\r\n    //如果图片大于四百万像素，计算压缩比并将大小压至400万以下\r\n    let ratio;\r\n    if ((ratio = width * height / 4000000) > 1) {\r\n        console.log(\"大于400万像素\")\r\n        ratio = Math.sqrt(ratio);\r\n        width /= ratio;\r\n        height /= ratio;\r\n    } else {\r\n        ratio = 1;\r\n    }\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    //    铺底色\r\n    ctx.fillStyle = \"#fff\";\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n    //如果图片像素大于100万则使用瓦片绘制\r\n    let count;\r\n    if ((count = width * height / 1000000) > 1) {\r\n        console.log(\"超过100W像素\");\r\n        count = ~~(Math.sqrt(count) + 1); //计算要分成多少块瓦片\r\n        //      计算每块瓦片的宽和高\r\n        let nw = ~~(width / count);\r\n        let nh = ~~(height / count);\r\n        tCanvas.width = nw;\r\n        tCanvas.height = nh;\r\n        for (let i = 0; i < count; i++) {\r\n            for (let j = 0; j < count; j++) {\r\n                tctx.drawImage(img, i * nw * ratio, j * nh * ratio, nw * ratio, nh * ratio, 0, 0, nw, nh);\r\n                ctx.drawImage(tCanvas, i * nw, j * nh, nw, nh);\r\n            }\r\n        }\r\n    } else {\r\n        ctx.drawImage(img, 0, 0, width, height);\r\n    }\r\n    //修复ios上传图片的时候 被旋转的问题\r\n    if (Orientation != \"\" && Orientation != 1) {\r\n        switch (Orientation) {\r\n            case 6://需要顺时针（向左）90度旋转\r\n                this.rotateImg(img, 'left', canvas);\r\n                break;\r\n            case 8://需要逆时针（向右）90度旋转\r\n                this.rotateImg(img, 'right', canvas);\r\n                break;\r\n            case 3://需要180度旋转\r\n                this.rotateImg(img, 'right', canvas);//转两次\r\n                this.rotateImg(img, 'right', canvas);\r\n                break;\r\n        }\r\n    }\r\n    //进行最小压缩\r\n    let ndata = canvas.toDataURL('image/jpeg', 0.1);\r\n    console.log('压缩前：' + initSize);\r\n    console.log('压缩后：' + ndata.length);\r\n    console.log('压缩率：' + ~~(100 * (initSize - ndata.length) / initSize) + \"%\");\r\n    tCanvas.width = tCanvas.height = canvas.width = canvas.height = 0;\r\n    return ndata;\r\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"position\":\"fixed\",\"top\":\"0\"}},[_c('input',{attrs:{\"type\":\"file\"},on:{\"change\":_vm.subImg}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div style=\"position: fixed;top: 0;\">\r\n    <input type=\"file\" @change=\"subImg\">\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {imgPreview} from '../../libs/imgPreview'\r\nimport {postSuperviseImg} from \"../../api/supervise\"\r\nexport default {\r\n  data() {\r\n    return {\r\n\r\n    };\r\n  },\r\n  created:{\r\n\r\n  },\r\n  methods: {\r\n      subImg(e) {\r\n          imgPreview(e.target.files[0]).then(file => {\r\n              console.log(file)\r\n              var formData = new FormData();\r\n              formData.append('photo', file);\r\n              postSuperviseImg(formData).then(res => {\r\n                  console.log(res)\r\n\r\n              })\r\n          }).catch(file => {\r\n              console.log(file)\r\n              var formData = new FormData();\r\n              formData.append('photo', file);\r\n              postSuperviseImg(formData).then(res => {\r\n                  console.log(res)\r\n              })\r\n          })\r\n      }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n\r\n</style>\r\n","import mod from \"-!../../../node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/_thread-loader@1.2.0@thread-loader/dist/cjs.js!../../../node_modules/_babel-loader@8.0.5@babel-loader/lib/index.js!../../../node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/_vue-loader@15.6.2@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/_thread-loader@1.2.0@thread-loader/dist/cjs.js!../../../node_modules/_babel-loader@8.0.5@babel-loader/lib/index.js!../../../node_modules/_cache-loader@1.2.5@cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/_vue-loader@15.6.2@vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=2848e9ba&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/_vue-loader@15.6.2@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import axios from '@/libs/api.request'\r\nimport { getAxiosData } from '@/libs/util'\r\n\r\nexport const getDragList = () => {\r\n    return axios.request({\r\n        url: 'get_drag_list',\r\n        method: 'get'\r\n    })\r\n}\r\nexport const getProjectList = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/project_list.php',\r\n        data : data,\r\n        method: 'post'\r\n    })\r\n}\r\nexport const getContractList = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/project_info.php',\r\n        data : data,\r\n        method: 'post'\r\n    })\r\n}\r\n\r\nexport const getTreeSupervise = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/tree_list.php',\r\n        data : data,\r\n        method: 'post'\r\n    })\r\n}\r\nexport const getTreeSuperviseInfo = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/maps_record_list.php',\r\n        data : data,\r\n        method: 'post'\r\n    })\r\n}\r\n//二次邦码信息拉取\r\nexport const getTwoCodeInfo = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/search_my_maps.php',\r\n        method: 'post',\r\n        data:data\r\n    })\r\n}\r\n//二次邦码信息提交\r\nexport const postTreeInfo = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/update_tree_maps.php',\r\n        method: 'post',\r\n        data : data,\r\n    })\r\n}\r\n//监管状态拉取\r\nexport const getSuperviseStatus = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/check_maps_order.php',\r\n        method: 'post',\r\n        data : data,\r\n    })\r\n}\r\n//上传监管详情\r\nexport const postSuperviseInfo = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/maps_record_insert.php',\r\n        method: 'post',\r\n        data : data,\r\n    })\r\n}\r\n//监管图片上传\r\nexport const postSuperviseImg = (res) => {\r\n    return axios.request({\r\n        url: 'admin/supervise/maps_uploads.php',\r\n        method: 'post',\r\n        data : res,\r\n    })\r\n}\r\n//验收异常信息发送\r\nexport const postSuperviseUnusual = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/update_record_state.php',\r\n        method: 'post',\r\n        data : data,\r\n    })\r\n}\r\n//绑定手机号, 更改手机号\r\nexport const bindPhone = (res) => {\r\n    let data = getAxiosData(res);\r\n    return axios.request({\r\n        url: 'admin/supervise/binding_phone.php',\r\n        method: 'post',\r\n        data : data,\r\n    })\r\n}\r\n"],"sourceRoot":""}