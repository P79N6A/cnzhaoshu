var rows;var rand;var n;var deleten;var data=[];var dataid;var j=0;var dictionary_keys=[];var dictionary=[];var addressprice=[];var unit;var typename;var type;var county=[];var markj;var addresspricess;var datas;var detailed_address;var provinces=[];var buttomnum;var buttonumber=1;var order_detail=[];var ordername;var button_ordernumber=0;var cities="";var fatherprivious="";var pricescity=[];var sohard=[];var finalkey;var finalprice;var sheng=["安徽","北京","重庆","福建","甘肃","广东","广西","贵州","海南","河北","河南","黑龙江","湖北","湖南","山东","吉林","江苏","江西","辽宁","内蒙古","宁夏","青海","山西","陕西","上海","四川","天津","新疆","云南","浙江"];var showsheng=sheng;function loadaddress(){var b="";for(var a=0;a<sheng.length;a++){b+='<label class="bn sheng" id="sheng'+a+'"><input type="checkbox" value="'+sheng[a]+'">'+sheng[a]+"</label>"}$("#ads").html(b)}function loadHistoryData(){html='<caption><h1>苗木清单</h1></caption><tr id="header"><th id="r0">序号</th><th id="r4">编号</th><th id="r1">名称</th><th id="r2">规格(选中试试双击)</th><th id="r1">数量</th></tr>';$.getJSON("/com/order_temp_search.php",{uid:user.userid},function(d){if(d){var c=0;for(var b=0;b<d.length;b++){data[b]=d[b];j=1+b;var a=attributes_show(d[b]);attribute_shift(data[b]);html+="<tr>";html+="<th>"+j+"</th>";html+='<td id="edit">'+d[b].id+"</td>";html+="<td>"+d[b].name+"</td>";html+="<td>"+a+"</td>";html+="<td>"+d[b].count+"</td>";c+=d[b].count;html+="</tr>"}selectarea(data);$("#attributeshow").html(html);$("#attributeshow").append("<tr><td></td><td></td><td></td><td></td><td></td></tr>");$("#attributeshow tr").filter(":eq("+(1+b)+")").html('<th id="r2" colspan=4>合计:</th><td id="r1">'+c+"</td>")}});$("#attributeshow").html(html)}function selectarea(a){$.getJSON("/com/search_price_batch.php",{data:JSON.stringify(a)},function(e){for(var d=0;d<e.length;d++){provinces[d]=[];addressprice[d]={};for(var h=0;h<a.length;h++){if(a[h].id==e[d].id){addressprice[d].id=e[d].id;if(e[d].price){var f=0;addressprice[d].price=[];for(var g=0;g<e[d].price.length;g++){addressprice[d].price[f]=e[d].price[g];provinces[d][f]=e[d].price[g].province;f++}}else{addressprice[d].price=[];provinces[d]=""}}}}var c=[""];for(var b=0;b<provinces.length;b++){for(var g=0;g<provinces[b].length;g++){var h=0;for(var d=0;d<c.length;d++){if(c[d]!=provinces[b][g]){++h}if(h==c.length){c[c.length]=provinces[b][g]}}}}$(".sheng").hide();for(var d=0;d<c.length;d++){$('#ads input[type="checkbox"][value="'+c[d]+'"]').parent().show()}})}function attribute_shift(a){if(a.trunk_diameter){a.trunk_diameter=a.trunk_diameter.split(",")}if(a.ground_diameter){a.ground_diameter=a.ground_diameter.split(",")}if(a.plant_height){a.plant_height=a.plant_height.split(",")}if(a.crown){a.crown=a.crown.split(",")}if(a.branch_number){a.branch_number=a.branch_number.split(",")}if(a.bough_number){a.bough_number=a.bough_number.split(",")}if(a.age){a.age=a.age.split(",")}if(a.branch_length){a.branch_length=a.branch_length.split(",")}if(a.bough_length){a.bough_length=a.bough_length.split(",")}if(a.branch_point_height){a.branch_point_height=a.branch_point_height.split(",")}if(a.pot_diameter){a.pot_diameter=a.pot_diameter.split(",")}if(a.crown_cm){a.crown_cm=a.crown_cm.split(",")}if(a.plant_height_cm){a.plant_height_cm=a.plant_height_cm.split(",")}}function attributes_show(b){var a="";if(b.trunk_diameter){var c=b.trunk_diameter.replace(",","-");a+=" 胸径"+c+"公分"}if(b.pot_diameter){var c=b.pot_diameter.replace(",","-");a+=" 盆径"+c+"公分"}if(b.ground_diameter){var c=b.ground_diameter.replace(",","-");a+=" 地径"+c+"公分"}if(b.plant_height){var c=b.plant_height.replace(",","-");a+=" 株高"+c+"米"}if(b.plant_height_cm){var c=b.plant_height_cm.replace(",","-");a+=" 株高"+c+"公分"}if(b.crown){var c=b.crown.replace(",","-");a+=" 冠幅"+c+"米"}if(b.crown_cm){var c=b.crown_cm.replace(",","-");a+=" 冠幅"+c+"公分"}if(b.branch_number){var c=b.branch_number.replace(",","-");a+=" 分枝数"+c+"个"}if(b.bough_number){var c=b.bough_number.replace(",","-");a+=" 主枝数"+c+"个"}if(b.age){var c=b.age.replace(",","-");a+=" 苗龄"+c+"年"}if(b.branch_length){var c=b.branch_length.replace(",","-");a+=" 条长"+c+"米"}if(b.bough_length){var c=b.bough_length.replace(",","-");a+=" 主蔓(枝)长"+c+"米"}if(b.branch_point_height){var c=b.branch_point_height.replace(",","-");a+=" 分枝点高"+c+"米"}if(b.substrate){var c=b.substrate;a+=" 基质"+c}return a}function toadd(){var d=$("#add").html();var c={};for(var b=0;b<15;b++){if($(":input:text:eq("+b+")").is(":hidden")){$(":input:text:eq("+b+")").val("")}}if($.trim($("#name").val())!=""){c.name=$("#name").val()}if($.trim($("#trunk_diameter").val())!=""){c.trunk_diameter=sort($("#trunk_diameter").val())}if($.trim($("#plant_height").val())!=""){c.plant_height=sort($("#plant_height").val())}if($.trim($("#crown").val())!=""){c.crown=sort($("#crown").val())}if($.trim($("#branch_point_height").val())!=""){c.branch_point_height=sort($("#branch_point_height").val())}if($.trim($("#branch_number").val())!=""){c.branch_number=sort($("#branch_number").val())}if($.trim($("#ground_diameter").val())!=""){c.ground_diameter=sort($("#ground_diameter").val())
}if($.trim($("#bough_number").val())!=""){c.bough_number=sort($("#bough_number").val())}if($.trim($("#plant_height_cm").val())!=""){c.plant_height_cm=sort($("#plant_height_cm").val())}if($.trim($("#crown_cm").val())!=""){c.crown_cm=sort($("#crown_cm").val())}if($.trim($("#substrate").val())!=""){c.substrate=$("#substrate").val()}if($.trim($("#age").val())!=""){c.age=sort($("#age").val())}if($.trim($("#branch_length").val())!=""){c.branch_length=sort($("#branch_length").val())}if($.trim($("#pot_diameter").val())!=""){c.pot_diameter=sort($("#pot_diameter").val())}if($.trim($("#bough_length").val())!=""){c.bough_length=sort($("#bough_length").val())}if($.trim($("#count").val())!=""){c.count=$("#count").val()}if(isEmptyObject(c)&&(c.count!=null)&&(c.name!=null)){if(unit||typename||type){c.unit=unit;c.typename=typename;c.type=type}else{c.unit="株";c.typename="其他";c.type="11"}$("#attributein input").val("");hideattribute();var a=guige(c);if(d=="添加"){randomget();c.id=rand;rand="";shaixuandiqu(c);data[j]=c;j++;$.get("/com/order_temp_add.php",{uid:user.userid,data:JSON.stringify(c)},function(){})}else{c.id=dataid;shaixuandiqu(c);data[n]=c;$("#add").html("添加");$("#reset").html("清空");$.get("/com/order_temp_update.php",{uid:user.userid,data:JSON.stringify(c)},function(){})}$("#attributein input:text:first").focus()}else{alert("名称或数量未填写");$("#attributein #count").focus()}}function randomget(){rand=parseInt(Math.random()*1000000000);if(rand<100000000||rand==1000000000){randomget()}else{rand="050"+rand;return rand}}function guige(b){var a="";if(parseFloat(b.trunk_diameter)>0){a+=" 胸径:"+mark(b.trunk_diameter)+"公分"}if(parseFloat(b.ground_diameter)>0){a+=" 地径:"+mark(b.ground_diameter)+"公分"}if(parseFloat(b.plant_height)>0){a+=" 株高:"+mark(b.plant_height)+"米"}if(parseFloat(b.plant_height_cm)>0){a+=" 株高:"+mark(b.plant_height_cm)+"公分"}if(parseFloat(b.crown)>0){a+=" 冠幅:"+mark(b.crown)+"米"}if(parseFloat(b.crown_cm)>0){a+=" 冠幅:"+mark(b.crown_cm)+"公分"}if(parseFloat(b.branch_number)>0){a+=" 分枝数:"+mark(b.branch_number)+"个"}if(parseFloat(b.bough_number)>0){a+=" 主枝数:"+mark(b.bough_number)+"个"}if(parseFloat(b.age)>0){a+=" 苗龄:"+mark(b.age)+"年"}if(parseFloat(b.branch_length)>0){a+=" 条长:"+mark(b.branch_length)+"米"}if(parseFloat(b.bough_length)>0){a+=" 主蔓(枝)长:"+mark(b.bough_length)+"米"}if(parseFloat(b.branch_point_height)>0){a+=" 分枝点高:"+mark(b.branch_point_height)+"米"}if(parseFloat(b.pot_diameter)>0){a+=" 盆径:"+mark(b.pot_diameter)+"公分"}if(b.substrate!=undefined){a+=" 基质:"+b.substrate}return a}function mark(a){if(a){if(a[1]){return a[0]+"-"+a[1]}else{if(parseFloat(a[0])>0){return a[0]}}}}function shaixuandiqu(a){$.getJSON("/com/search_price.php",{data:JSON.stringify(a)},function(q){var c=q.price;if(n>-1){addressprice[n]=q;n=-1}else{addressprice[j-1]=q}if(q.price){var l=[];var e=0;for(var f=0;f<c.length;f++){e+=1;var g=c[f].count;var d=c[f].province;var o=c[f].total;l[f]=d}provinces[j-1]=l}var b=[""];for(var p=0;p<provinces.length;p++){if(provinces[p]!=undefined){for(var h=0;h<provinces[p].length;h++){var k=0;for(var f=0;f<b.length;f++){if(b[f]!=provinces[p][h]){++k}if(k==b.length){b[b.length]=provinces[p][h]}}}}}$(".sheng").hide();$(".tree_arrive_address_citys").hide();$('input[type="checkbox"]').prop("checked",false);cities="";fatherprivious="";pricescity=[];sohard=[];for(var f=0;f<b.length;f++){$('#ads input[type="checkbox"][value="'+b[f]+'"]').parent().show()}showprice()})}function sort(a){return a.replace("－","-").replace("。",".").split("-")}function reset(){var b=$("#reset").html();if(b=="清空"){$("#attributein input").val("")}else{var a=data[n]["id"];data[n]="";addressprice[n]="";provinces[n]="";$('input[type="checkbox"]').prop("checked",false);$("#tree_arrive_address_city").html("");cities="";fatherprivious="";pricescity=[];sohard=[];showprice();n=-1;$("#attributein input").val("");hideattribute();$("#add").html("添加");$("#reset").html("清空");$("#attributeshow").css("background-color","#ffffff");$("#header").css("background-color","#cccccc");$.get("/com/order_temp_deletepc.php",{userid:user.userid,id:a},function(){})}}function zhaoname(){var c=$("#name").val();var e;for(var d=0;d<dictionary.length;d++){if(dictionary[d].name==c){e=dictionary[d]}}var a={5:"trunk_diameter",6:"ground_diameter",7:"pot_diameter",8:"age",9:"crown",10:"plant_height",11:"branch_length",12:"bough_length",13:"branch_point_height",14:"branch_number",15:"bough_number",17:"plant_height_cm",18:"crown_cm",19:"substrate"};for(var d=5;d<20;d++){$("#"+a[d]+"1").hide()}if(!e){$("#name-id").val(c);$("#trunk_diameter1").show();$("#crown1").show();$("#plant_height1").show()}else{var f=e.attribute;unit=e.unit;typename=e.typename;type=e.type;var b=f.split(",");for(var g=0;g<b.length;g++){if(a[b[g]]){$("#"+a[b[g]]+"1").show()}}}}function hideattribute(){var a={5:"trunk_diameter",6:"ground_diameter",7:"pot_diameter",8:"crown",9:"plant_height",10:"branch_length",11:"bough_length",12:"branch_point_height",13:"branch_number",14:"bough_number",15:"age",17:"plant_height_cm",18:"crown_cm",19:"substrate"};
for(var b=5;b<20;b++){$("#"+a[b]+"1").hide()}}$(function(){$.getJSON("/com/dictionary_attribute_search.php",function(a){if(a){dictionary=a;$("#name").autocomplete({minLength:2,source:dictionary,search:function(b){return b.jianpin+b.name},label:function(b){return b.name},select:function(b){buttomnum=-1;$("#name-id").val(b);zhaoname()}})}})});function isEmptyObject(b){var a;for(a in b){return true}return false}$("#attributeshow").on("click","tr",function(){var f=$(this).find("#r2").html();var d=$(this).find("#r0").html();if(f=="合计:"||d=="序号"){return false}else{var a=$(this).find("#edit").html();$(this).css("background","#cccccc");$(this).siblings().css("background","#ffffff");$("#header").css("background-color","#cccccc");dataid=$(this).find("#edit").html();rows=$(this).find("#edit").prev().html();for(var e=0;e<data.length;e++){if(data[e].id==dataid){n=e}}var g=data[n];var b={5:"trunk_diameter",6:"ground_diameter",7:"pot_diameter",8:"crown",9:"plant_height",10:"branch_length",11:"bough_length",12:"branch_point_height",13:"branch_number",14:"bough_number",15:"age",17:"plant_height_cm",18:"crown_cm",19:"substrate"};for(var e=5;e<20;e++){if(g[b[e]]){$("#"+b[e]+"1").css("display","black");$("#"+b[e]).val(g[b[e]])}}$("#add").html("修改");$("#reset").html("删除");hideattribute();var c=$("#name").val(g.name);zhaoname();$("#count").val(g.count);$("#trunk_diameter").val(join(g.trunk_diameter));$("#plant_height").val(join(g.plant_height));$("#crown").val(join(g.crown));$("#branch_point_height").val(join(g.branch_point_height));$("#branch_number").val(join(g.branch_number));$("#ground_diameter").val(join(g.ground_diameter));$("#bough_number").val(join(g.bough_number));$("#age").val(join(age));$("#branch_length").val(join(g.branch_length));$("#pot_diameter").val(join(g.pot_diameter));$("#plant_height_cm").val(join(g.plant_height_cm));$("#crown_cm").val(join(g.crown_cm));$("#substrate").val(g.substrate);$("#bough_length").val(join(g.bough_length));buttomnum=n}});$("#attributeshow").on("dblclick","tr",function(){var d=$(this).find("#r2").html();var b=$(this).find("#r0").html();if(d=="合计:"||b=="序号"){return false}else{var a=$(this).find("#edit").html();for(var c=0;c<data.length;c++){if(data[c].id==dataid){n=c}}var f=data[n];var e='"exact":1,"key":"'+f.name+'"';if(f.trunk_diameter){if(f.trunk_diameter[1]){e+=',"dbh":"'+f.trunk_diameter[0]+"-"+f.trunk_diameter[1]+'"'}else{if(f.trunk_diameter[0]){e+=',"dbh":"'+f.trunk_diameter[0]+'"'}}}else{if(f.ground_diameter){if(f.ground_diameter[1]){e+=',"dbh":"'+f.ground_diameter[0]+"-"+f.ground_diameter[1]+'"'}else{if(f.ground_diameter[0]){e+=',"dbh":"'+f.ground_diameter[0]+'"'}}}else{if(f.pot_diameter){if(f.pot_diameter[1]){e+=',"dbh":"'+f.pot_diameter[0]+"-"+f.pot_diameter[1]+'"'}else{if(f.pot_diameter[0]){e+=',"dbh":"'+f.pot_diameter[0]+'"'}}}}}if(f.plant_height){if(f.plant_height[1]){e+=',"height":"'+f.plant_height[0]+"-"+f.plant_height[1]+'"'}else{if(f.plant_height[0]){e+=',"height":"'+f.plant_height[0]+'"'}}}else{if(f.branch_length){if(f.branch_length[1]){e+=',"height":"'+f.branch_length[0]+"-"+f.branch_length[1]+'"'}else{if(f.branch_length[0]){e+=',"height":"'+f.branch_length[0]+'"'}}}else{if(f.bough_length){if(f.bough_length[1]){e+=',"height":"'+f.bough_length[0]+"-"+f.bough_length[1]+'"'}else{if(f.bough_length[0]){e+=',"height":"'+f.bough_length[0]+'"'}}}else{if(f.plant_height_cm){if(f.plant_height_cm[1]){e+=',"height":"'+(f.plant_height_cm[0])/100+"-"+(f.plant_height_cm[1])/100+'"'}else{if(f.plant_height_cm[0]){e+=',"height":"'+(f.plant_height_cm[0])/100+'"'}}}}}}if(f.crown){if(f.crown[1]){e+=',"crownwidth":"'+f.crown[0]+"-"+f.crown[1]+'"'}else{if(f.crown[0]){e+=',"crownwidth":"'+f.crown[0]+'"'}}}if(f.crown_cm){if(f.crown_cm[1]){e+=',"crownwidth":"'+(f.crown_cm[0])/100+"-"+(f.crown_cm[1])/100+'"'}else{if(f.crown_cm[0]){e+=',"crownwidth":"'+(f.crown_cm[0])/100+'"'}}}if(f.branch_point_height){if(f.branch_point_height[1]){e+=',"branch_point_height":"'+f.branch_point_height[0]+"-"+f.branch_point_height[1]+'"'}else{if(f.branch_point_height[0]){e+=',"branch_point_height":"'+f.branch_point_height[0]+'"'}}}if(f.branch_number){if(f.plant_height[1]){e+=',"branch_bough_number":"'+f.branch_number[0]+"-"+f.branch_number[1]+'"'}else{if(f.branch_number[0]){e+=',"branch_bough_number":"'+f.branch_number[0]+'"'}}}if(f.bough_number){if(f.bough_number[1]){e+=',"branch_bough_number":"'+f.bough_number[0]+"-"+f.bough_number[1]+'"'}else{if(f.bough_number[0]){e+=',"branch_bough_number":"'+f.bough_number[0]+'"'}}}if(f.substrate){if(f.substrate){e+=',"substrate":"'+f.substrate+'"'}}window.open("http://cnzhaoshu.com/index.html?where={"+e+"}")}});function join(a){if(a){if(a[1]){return a[0]+"-"+a[1]}else{return a[0]}}}function showprice(){finalkey=[];finalprice=[];var l=[];var c=[];var b="";$("#ads input:checkbox:checked").each(function(){b+=$(this).val()+","});b=b.substring(0,b.length-1);for(var w=0;w<l.length;w++){l[w]=0}for(var p=0;p<cities.length;p++){c[p]=0}b=b.split(",");var A=[""];for(var h=0;h<provinces.length;
h++){if(provinces[h]!=undefined){for(var f=0;f<provinces[h].length;f++){var g=0;for(var w=0;w<A.length;w++){if(A[w]!=provinces[h][f]){++g}if(g==A.length){A[A.length]=provinces[h][f]}}}}}var D=[];for(var w=0;w<sheng.length;w++){for(var h=0;h<A.length;h++){if(sheng[w]==A[h]){D[D.length]=A[h]}}}A=[];A=D;$(".sheng").hide();var B=[];for(var w=0;w<A.length;w++){$('#ads input[type="checkbox"][value="'+A[w]+'"]').parent().show();for(var h=0;h<b.length;h++){if(b[h]==A[w]){B[B.length]=b[h]}}}b=B;$("#ads input[type='checkbox']").prop("checked",false);for(var w=0;w<b.length;w++){$("#ads input[value='"+b[w]+"']").prop("checked","checked")}var d='<caption><h1>苗木清单</h1></caption><tr id="header"><th id="r0">序号</th><th id="r1">编号</th><th id="r0">名称</th><th id="r2">规格(选中试试双击)</th><th id="r0">数量</th>';for(var w=0;w<b.length;w++){if(b[w]){var a=0;if(fatherprivious){for(var o=0;o<fatherprivious.length;o++){if(fatherprivious[o]==b[w]){a=1}}}if(a==0){d+='<th id="r0">'+b[w]+"</th>";finalkey[finalkey.length]=b[w]}}}for(var w=0;w<cities.length;w++){if(cities[w]){d+='<th id="r0">'+cities[w]+"</th>";finalkey[finalkey.length]=cities[w]}}d+="</tr>";var e=0;for(var f=0;f<b.length;f++){l[f]=0}var g=0;for(var w=0;w<data.length;w++){if(data[w]){g++;var v=g-1;finalprice[v]=[];var s=guige(data[w]);var u=addressprice[w].price;d+="<tr>";d+="<th>"+g+"</th>";d+='<td id="edit">'+data[w].id+"</td>";d+="<td>"+data[w].name+"</td>";d+="<td>"+s+"</td>";d+="<td>"+data[w].count+"</td>";e+=parseInt(data[w].count);if(b[0]){for(var f=0;f<b.length;f++){if(fatherprivious){var a=0;for(var o=0;o<fatherprivious.length;o++){if(fatherprivious[o]==b[f]){a=1}}if(a==0){var h=0;if(addressprice[w].price!=null&&addressprice[w].price[0]){for(var r=0;r<u.length;r++){if(u[r].province==b[f]){d+="<td>"+(u[r].avg).toFixed(1)+"</td>";l[f]+=u[r].avg*data[w].count;finalprice[v][finalprice[v].length]=u[r].avg}else{++h}if(h==u.length){d+="<td>0</td>";finalprice[v][finalprice[v].length]=0}}}else{d+="<td>0</td>";finalprice[v][finalprice[v].length]=0}}}else{var h=0;if(addressprice[w].price!=null&&addressprice[w].price[0]){for(var r=0;r<u.length;r++){if(u[r].province==b[f]){d+="<td>"+(u[r].avg).toFixed(1)+"</td>";l[f]+=u[r].avg*data[w].count;finalprice[v][finalprice[v].length]=u[r].avg}else{++h}if(h==u.length){d+="<td>0</td>";finalprice[v][finalprice[v].length]=0}}}else{d+="<td>0</td>";finalprice[v][finalprice[v].length]=0}}}}if(cities[0]){for(var f=0;f<b.length;f++){for(var p=0;p<cities.length;p++){if(pricescity[b[f]][w]!="undefined"){if(pricescity[b[f]][w]!=undefined){var C=pricescity[b[f]][w][cities[p]];if(C){d+="<td>"+C.toFixed(1)+"</td>";finalprice[v][finalprice[v].length]=C;c[p]+=C*data[w].count}else{if(sohard[b[f]][cities[p]]){d+="<td>0</td>";finalprice[v][finalprice[v].length]=0}}}else{d+="<td>0</td>";finalprice[v][finalprice[v].length]=0}}else{d+="<td>0</td>";finalprice[v][finalprice[v].length]=0}}}}d+="<tr>"}}d+='<tr><th id="r2" colspan=4>合计:</th><td id="r0">'+e+"</td>";if(b[0]){for(var w=0;w<b.length;w++){if(b[w]){var a=0;if(fatherprivious){for(var o=0;o<fatherprivious.length;o++){if(fatherprivious[o]==b[w]){a=1}}}if(a==0){d+='<td id="r0">'+l[w].toFixed(0);+"</td>"}}}}if(cities[0]){for(var w=0;w<cities.length;w++){d+='<td id="r0">'+c[w].toFixed(0);+"</td>"}}$("#attributeshow").html();$("#attributeshow").html(d)}function final_deal(){var c=$(".province").val();var e=$(".city").val();var a=$(".area").val();if(c){detailed_address=c}if(e){detailed_address+="."+e}if(a){detailed_address+="."+a}var h=[];var d=0;for(var l=0;l<data.length;l++){if(data[l]){h[d]={};h[d].id=data[l].id;d++}}if(finalkey){for(var l=0;l<finalprice.length;l++){for(var f=0;f<finalkey.length;f++){h[l][finalkey[f]]=finalprice[l][f]}}var g=0;var k=[];var b=h;for(var f=1;f<12;f++){for(var l=0;l<data.length;l++){if((data[l].type==f)&&data[l]){k[g]=data[l];g++}}}}else{var g=0;var k=[];var b=1;for(var f=1;f<12;f++){for(var l=0;l<data.length;l++){if((data[l].type==f)&&data[l]){k[g]=data[l];g++}}}}datas=JSON.stringify(k);addresspricess=JSON.stringify(b)}function loadHistoryorder(){$.cxSelect.defaults.url="js/chinaarea.min.json";$.getJSON("/com/order_index_search.php",{userid:user.userid},function(d){if(d){var b=d[d.length-1].address;if(b!=0){var e=b.split(".");if(e[0]){$(".province").attr("data-value",e[0])}if(e[1]){$(".city").attr("data-value",e[1])}if(e[2]){$(".area").attr("data-value",e[2])}}else{$(".province").attr("data-value","北京市");$(".city").attr("data-value","通州区")}var a="";for(var c=0;c<d.length;c++){a+='<div class="history_order_contents">';a+='<div class="ordername">'+d[c].ordername+"</div>";a+='<div class="ordertime">'+d[c].time+"</div>";a+='<input type="hidden" class="history_orderid" value="'+d[c].id+'">';a+='<input type="hidden" class="history_orderaddress" value="'+d[c].address+'">';a+='<div class="edit" style="display:none"><div class="copy">另存为</div><div class="delete">删除</div></div>';a+="</div>"}$("#history_contents").html(a)}});$("#tree_arrive_address_name").cxSelect({selects:["province","city","area"]})
}function showhistoryorder(l){if(l[0]!=undefined){var a=[];for(var d=0;d<l.length;d++){a[d]=l[d].address_price}var e=[];var b=[];for(var d=0;d<a.length;d++){if(a[d]!=undefined){a[d]=a[d].split(",");e[d]=[];for(var k=0;k<a[d].length;k++){a[d][k]=a[d][k].split(":");e[d][a[d][k][0]]=a[d][k][1];b[k]=a[d][k][0]}}}}var c="<caption><h1>"+ordername+'</h1></caption><tr id="header"><th id="r0">序号</th><th id="r4">编号</th><th id="r1">名称</th><th id="r2">规格</th><th id="r1">数量</th>';if(l[0]!=undefined){for(var d=0;d<b.length;d++){if(b[d]){c+='<th id="r1">'+b[d]+"</th>"}}var f=[];for(var k=0;k<b.length;k++){f[k]=0}}c+="</tr>";var h=0;for(var d=0;d<l.length;d++){var g=attributes_show(l[d]);c+="<tr>";c+="<th>"+(1+d)+"</th>";c+='<td id="edit">'+l[d].id+"</td>";c+="<td>"+l[d].name+"</td>";c+="<td>"+g+"</td>";c+="<td>"+l[d].count+"</td>";if(l[0].address_price){for(var k=0;k<b.length;k++){if(b[k]){c+="<td>"+e[d][b[k]]+"</td>";f[k]+=parseInt(e[d][b[k]])*parseInt(l[d].count)}}}h+=l[d].count;c+="</tr>"}c+='<tr><th id="r2" colspan=4>合计:</th><td id="r1">'+h+"</td>";if(l[0]!=undefined){for(var k=0;k<b.length;k++){if(b.length>0){if(f[k]){c+="<td>"+f[k]+"</td>"}else{c+="<td>0</td>"}}}}c+="</tr>";$("#attributeshow").html();$("#attributeshow").html(c)}$("#history_contents").on("click",".ordername",function(){ordername=$(this).html();var b=$(this).parents(".history_order_contents").find(".history_orderid").val();var c=$(this).parents(".history_order_contents").find(".history_orderaddress").val();if((c!=0)&&(c!="null")){var a=c.split(".");if(a[0]!="null"){$('#tree_arrive_address_name input[name="province"]').val(a[0])}else{$('#tree_arrive_address_name input[name="province"]').val("省")}if(a[1]!="null"){$('#tree_arrive_address_name input[name="city"]').val(a[1])}else{$('#tree_arrive_address_name input[name="city"]').val("市")}if(a[2]!="null"){$('#tree_arrive_address_name input[name="area"]').val(a[2])}else{$('#tree_arrive_address_name input[name="area"]').val("县")}}else{$('#tree_arrive_address_name input[name="province"]').val("省");$('#tree_arrive_address_name input[name="city"]').val("市");$('#tree_arrive_address_name input[name="area"]').val("县")}$.getJSON("/com/order_search.php",{orderid:b,userid:user.userid},function(d){showhistoryorder(d);$(".sheng").hide()})});$("#history_contents").on("click",".delete",function(){var b=$(this).parents(".history_order_contents").find(".history_orderid").val();var a=$(this);$.get("/com/order_delete.php",{orderid:b,userid:user.userid},function(c){a.parents(".history_order_contents").hide()})});$("#history_contents").on("click",".copy",function(){addressprice=[];historybutn=0;$.getJSON("/com/order_temp_deletepc.php",{userid:user.userid,order:"-1"},function(b){});var a=$(this).parents(".history_order_contents").find(".history_orderid").val();$.getJSON("/com/order_search.php",{orderid:a,userid:user.userid},function(h){var d=JSON.stringify(h);$.getJSON("/com/order_temp_adds.php",{data:d},function(i){});data=[];provinces=[];addressprice=[];for(var c=0;c<h.length;c++){data[c]={};for(var g in h[c]){var e=["trunk_diameter","ground_diameter","pot_diameter","crown","plant_height","branch_length","bough_length","branch_point_height","branch_number","bough_number","age","plant_height_cm","crown_cm","substrate"];for(var f=0;f<e.length;f++){if(g==e[f]){data[c][g]=h[c][g].split(",");var b=attributes_show(h[c])}}}data[c]["id"]=h[c]["id"];data[c]["name"]=h[c]["name"];data[c]["count"]=h[c]["count"];data[c]["type"]=h[c]["type"];data[c]["typename"]=h[c]["typename"];data[c]["unit"]=h[c]["unit"];data[c]["userid"]=h[c]["userid"]}j=data.length;$.getJSON("/com/search_price_batch.php",{data:JSON.stringify(data)},function(o){for(var m=0;m<o.length;m++){provinces[m]=[];addressprice[m]={};for(var s=0;s<data.length;s++){if(data[s].id==o[m].id){addressprice[m].id=o[m].id;if(o[m].price){var q=0;addressprice[m].price=[];for(var r=0;r<o[m].price.length;r++){addressprice[m].price[q]=o[m].price[r];provinces[m][q]=o[m].price[r].province;q++}}else{addressprice[m].price=[];provinces[m]=""}}}}var l=[""];for(var k=0;k<provinces.length;k++){for(var r=0;r<provinces[k].length;r++){var s=0;for(var m=0;m<l.length;m++){if(l[m]!=provinces[k][r]){++s}if(s==l.length){l[l.length]=provinces[k][r]}}}}$(".sheng").hide();$(".tree_arrive_address_citys").hide();$('input[type="checkbox"]').prop("checked",false);for(var m=0;m<l.length;m++){$('#ads input[type="checkbox"][value="'+l[m]+'"]').parent().show()}cities="";fatherprivious="";pricescity=[];sohard=[];$("#label1").css("background","#ccc");$("#label2").css("background","#fff");$("#submit_button").show();$("#tree_arrive_aaddress").show();$("#tree_arrive_address_city").show();$("#attributein").show();$("#history").hide();$("#attributein input").val("");$(".cxselect").show();$(".hideform").hide();hideattribute();$("#add").html("添加");$("#reset").html("清空");showprice();n=-1})})});function searchhistoryorder(){var c=$("#key_name").val();var d=$("#key_area").val();var b=$("#demo").val();var a=$("#key_time2").val();$.getJSON("/com/order_index_search.php",{area:d,name:c,time1:b,time2:a,userid:user.userid},function(g){$("#history_contents").html("");
if(g){var e="";for(var f=0;f<g.length;f++){e+='<div class="history_order_contents">';e+='<div class="ordername">'+g[f].ordername+"</div>";e+='<div class="ordertime">'+g[f].time+"</div>";e+='<input type="hidden" class="history_orderid" value="'+g[f].id+'">';e+='<input type="hidden" class="history_orderaddress" value="'+g[f].address+'">';e+='<div class="edit" style="display:none"><div class="copy">另存为</div><div class="delete">删除</div></div>';e+="</div>"}$("#history_contents").html(e)}})}$(function(){laydate({elem:"#demo"})});$("#ads").on("change",".sheng",function(){var b="";var e="";$("#ads input:checkbox:checked").each(function(){e+=$(this).val()+","});if(e.length>0){e=e.substring(0,e.length-1);e=e.split(",");for(var c=0;c<e.length;c++){var d=haveareacity(e[c]);if(d){b+='<div class="tree_arrive_address_citys">';b+='<div class="area_city">'+e[c]+":</div>";b+='<div class="area_city_name">';sohard[e[c]]=[];for(var a=0;a<d.length;a++){b+='<label class="city_bn"><input type="checkbox" value="'+d[a]+'">'+d[a]+"</label>";sohard[e[c]][d[a]]=1}b+="</div>";b+="</div>"}}$("#tree_arrive_address_city").html(b)}else{$("#tree_arrive_address_city").html("")}if(cities!=""){for(var c=0;c<cities.length;c++){$("input[value="+cities[c]+"]").attr("checked","checked")}}showprice()});$("#tree_arrive_address_city").on("change",".city_bn",function(){var a="";cities="";$("#tree_arrive_address_city input:checkbox:checked").each(function(){cities+=$(this).val()+",";a+=$(this).parents(".tree_arrive_address_citys").find(".area_city").html()});if(cities.length>0){cities=cities.substring(0,cities.length-1);cities=cities.split(",")}if(a.length>0){a=a.substring(0,a.length-1);a=a.split(":")}fatherprivious=a;showprice()});function haveareacity(h){var d="";pricescity[h]=[];for(var b=0;b<addressprice.length;b++){if(addressprice[b]){pricescity[h][b]=[];var e=addressprice[b].price;if(e){for(var a=0;a<e.length;a++){if(e[a].province==h){var g=e[a].city;for(var f=0;f<g.length;f++){d+=g[f].city+".";pricescity[h][b][g[f].city]=g[f].avg}}}}else{pricescity[h][b]=0}}}d=d.substring(0,d.length-1);d=d.split(".");var c=[];for(var b=0;b<d.length;b++){var f=0;if(c.length==0){c[0]=d[b]}else{for(var a=0;a<c.length;a++){if(d[b]!=c[a]){f++}if(f==c.length){c[c.length]=d[b]}}}}return c}function bindInputEvent(){$("#attributein input:text:first").focus();$("#attributein input:text:first").bind("keydown",function(b){var a=b.which;if(a==13){zhaoname()}});$("#attributein  input:text").bind("keydown",function(c){var a=c.which;if(a==13){c.preventDefault();var b=$("#attributein input:text").index(this)+1;if(b<17){while($("#attributein :input:text:eq("+b+")").is(":visible")==false&&b<17){b=b+1}$("#attributein :input:text:eq("+b+")").focus();if(b==17){toadd()}}else{toadd()}}});$("#history  input:text").bind("keydown",function(c){var a=c.which;if(a==13){c.preventDefault();var b=$("#history input:text").index(this)+1;if(b<2){$("#history :input:text:eq("+b+")").focus()}}});$("#order_name_button  input:text").bind("keydown",function(d){var a=d.which;if(a==13){d.preventDefault();var c=$("#order_name_button input:text").index(this)+1;if(c=2){final_deal();var b=$("#order_name").val();$.get("/com/order_add.php",{uid:user.userid,data:datas,addressprices:addresspricess,useraddress:detailed_address,ordername:b},function(e){loadHistoryorder();alert("成功存入我的清单!");data=[];addressprice=[];$('input[type="checkbox"]').prop("checked",false);cities="";fatherprivious="";pricescity=[];sohard=[];$("#tree_arrive_address_city").html("");$(".sheng").css("display","none");provinces=[];showprice();$(".sheng").hide()});button_ordernumber=0}}})}function bindButtonEvent(){$("#add").click(function(){toadd()});$("#reset").click(function(){reset()});$("#key_search").click(function(){searchhistoryorder()});$("#key_reset").click(function(){$("#history input").val("")});$("#deal").click(function(){$(".alertordername").show();button_ordernumber=1});$("#myorder").click(function(){$(".alertordername").show();button_ordernumber=2});$("#join_order").click(function(){$(".alertordername").show();button_ordernumber=3});$("#order_name_button_reset").click(function(){$(".alertordername").hide();$("#order_name").val("");button_ordernumber=0});$("#order_name_button").click(function(){final_deal();var a=$("#order_name").val();$(".alertordername").hide();if(button_ordernumber==1){window.location="/excel.php?uid="+user.userid+"&data="+datas+"&addressprices="+addresspricess+"&useraddress="+detailed_address+"&ordername="+a;button_ordernumber=0}else{if(button_ordernumber==2){window.location="/require_list.php?uid="+user.userid+"&data="+datas+"&addressprices="+addresspricess+"&useraddress="+detailed_address+"&ordername="+a;button_ordernumber=0}else{if(button_ordernumber==3){$.get("/com/order_add.php",{uid:user.userid,data:datas,addressprices:addresspricess,useraddress:detailed_address,ordername:a},function(b){loadHistoryorder();alert("成功存入我的清单!");data=[];addressprice=[];$('input[type="checkbox"]').prop("checked",false);cities="";fatherprivious="";
pricescity=[];sohard=[];$("#tree_arrive_address_city").html("");$(".sheng").css("display","none");provinces=[];showprice();$(".sheng").hide()});button_ordernumber=0}}}});$("#label1").click(function(){$("#label1").css("background","#ccc");$("#submit_button").show();$("#tree_arrive_aaddress").show();$("#tree_arrive_address_city").show();$("#label2").css("background","#fff");$("#attributein").show();$("#history").hide();$("#attributeshow").html("");$("#attributein input").val("");hideattribute();$("#add").html("添加");$("#reset").html("清空");$(".cxselect").show();$(".hideform").hide();showprice();n=-1});$("#label2").click(function(){$("#label2").css("background","#ccc");$("#label1").css("background","#fff");$("#submit_button").hide();$("#tree_arrive_aaddress").hide();$("#tree_arrive_address_city").hide();$("#tree_arrive_address_name input").val("");$("#history").show();$("#attributein").hide();$(".cxselect").hide();$(".hideform").show();$("#attributeshow").html('<caption><h1>历史清单</h1></caption><tr id="header"><th id="r0">序号</th><th id="r1">编号</th><th id="r0">名称</th><th id="r2">规格</th><th id="r0">数量</th>');$(".sheng").hide();n=-1});$("#history_contents").on("mouseover",".history_order_contents",function(){$(this).css("background","#eee");$(this).siblings().css("background","#fff");$(this).find(".edit").show();$(this).find(".ordertime").hide()});$("#history_contents").on("mouseout",".history_order_contents",function(){$(this).find(".ordertime").show();$(this).css("background","#fff");$(this).find(".edit").hide()})}function bindDocumentClickCancleModify(){$(document).click(function(b){if(buttomnum>-1){var a=$(b.target).parents("#fatherresetinput:first").attr("id");if(a!="fatherresetinput"&&a!="fatherresetinput"){buttomnum=-1;$("#attributeshow tr").css("background","#ffffff");$("#header").css("background-color","#cccccc");$("#attributein input").val("");hideattribute();$("#add").html("添加");$("#reset").html("清空")}}})}if(user){loadHistoryData();loadaddress();loadHistoryorder();bindInputEvent();bindButtonEvent();bindDocumentClickCancleModify()}else{login()};