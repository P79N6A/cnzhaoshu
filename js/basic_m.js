var isPc=!1,page=0,itemHeight=101,pageItems=Math.ceil($(window).height()/itemHeight),isLoading=!1,isEnd=!1,trees=[],scrollTop,scrollTopTreeView,user;function urlRequest(a){return(a=RegExp("[?&]"+a+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(a[1].replace(/\+/g," "))}function addcookie(a,d){var b=new Date;b.setTime(b.getTime()+31536E7);document.cookie=a+"="+escape(d)+";expires="+b.toGMTString()+";path=/;domain=cnzhaoshu.com"}function getcookie(a){for(var d=document.cookie.split("; "),b=0;b<d.length;b++){var c=d[b].split("=");if(c[0]==a)return unescape(c[1])}}function loadJS(a){var d=document.createElement("script");d.src=a;document.body.appendChild(d)}function isPhone(a){return/^1[3-5,7-8]{1}[0-9]{9}$/.test(a)||/^([0-9]{3,4}-)?[0-9]{7,8}$/.test(a)}function inArray(a,d){for(var b in d)if(d[b]==a)return!0;return!1}function showTime(a){a=a.replace(/-/g,"/");a=new Date(a);a=(new Date).getTime()-a.getTime();return 36E5>a?(a=Math.floor(a/ 6E4), 0 == a ? "\u521a\u521a" : a + "\u5206\u949f\u524d") : 864E5 > a ? Math.floor(a /36E5)+"\u5c0f\u65f6\u524d":2592E6>a?Math.floor(a/ 864E5) + "\u5929\u524d" : 31104E6 > a ? Math.floor(a /2592E6)+"\u6708\u524d":"1\u5e74\u524d"}function mORcm(a){return 1>a?Math.round(100*a)+"\u516c\u5206":a+"\u7c73"}function search(a,d,b){isLoading||(isLoading=!0,window.url_shop_id&&(d=""),$("#searchmore").show(),0==$("#treelist li").length&&(trees=[]),$.getJSON("com/search.php",{where:a,limit:d},function(a){if(a){var b=trees.length;trees=trees.concat(a);for(var c=trees.length;b<c;b++){var d=addTree(trees[b],b);$("#treelist").append(d)}isEnd=a.length<pageItems}else isEnd=!0;isLoading=!1;$("#searchmore").hide();$("#where").html()?$("#where").show():$("#where").hide();0<trees.length?$("#province").show():$("#province").hide();try{prepareShare()}catch(f){}}),page++,setPrice(a,b))}function attribute(a){var d=[];a.dbh&&d.push("\u5f84"+a.dbh+"\u516c\u5206");a.age&&d.push("\u9f84"+a.age+"\u5e74");a.crownwidth&&d.push("\u51a0"+mORcm(a.crownwidth));a.height&&d.push("\u9ad8"+mORcm(a.height));a.branch_point_height&&d.push("\u5206"+mORcm(a.branch_point_height));a.branch_bough_number&&d.push("\u679d"+a.branch_bough_number+"\u4e2a");return d.join(" ")}function addTree(a,d){a.pname&&(a.name="'"+a.pname+"'"+a.name);a.age&&(a.age=parseFloat(a.age));a.dbh&&(a.dbh=parseFloat(a.dbh));a.height&&(a.height=parseFloat(a.height));a.crownwidth&&(a.crownwidth=parseFloat(a.crownwidth));a.branch_point_height&&(a.branch_point_height=parseFloat(a.branch_point_height));a.price=Math.round(100*a.price)/100;0==a.price&&(a.price="\u8bae\u4ef7");a.unit||(a.unit="\u682a");a.imgpath=decodeImgpath(a.imgpath);a.phototime&&(a.phototime=a.phototime.split(";"),a.photogps=a.photogps.split(";"));var b="";switch(a.state){case 2:b='<span class="renzheng">\u5df2\u8ba4\u8bc1</span>';break;case 3:b='<span class="qjd">\u65d7\u8230\u5e97</span>';break;case 4:b='<span class="qjd">\u5355\u54c1\u738b</span>'}var c=0<a.collections?'<span class="cangmi">\u85cf\u7c73'+a.collections+"</span>":"";d='<a href="javascript:showtree('+d+')">'+('<img src="/trees/s2/'+a.imgpath[0]+'" />');a.invoice&&(d+='<img class="fapiao" src="/img/fapiao.png?t=2">');a.userstate&&(d+='<img style="position: absolute; width: 40px; height: 40px; border-radius: 50%; margin: 50px 0 0 -40px;" onerror="this.parentNode.removeChild(this);" src="/platform/'+a.userstate+'.png">');a.phototime&&(d+='<div class="poi"></div>');101!=a.type?(d+="<h2>"+a.name.substring(0,8)+"<span>\u00a5"+a.price+"</span> <i>"+showTime(a.time)+"</i>"+b+"</h2>",d+="<h3>"+attribute(a)+"</h3>",d+="<h3>"+a.username+"</h3>",d+="<h3>"+a.province+a.district+" "+a.count+a.unit+c+"</h3></a>"):(d+="<h2>"+a.name.substring(0,8)+" <i>"+showTime(a.time)+"</i>"+b+"</h2>",d+="<h3>"+a.remark+"</h3>",d+="<h3>"+a.username+"</h3>",d+="<h3>"+a.province+a.district+" "+c+"</h3></a>");a=document.createElement("li");a.innerHTML=d;return a}function showtree(a){var d={5:"\u80f8\u5f84",6:"\u5730\u5f84",7:"\u76c6\u5f84",10:"\u682a\u9ad8",11:"\u6761\u957f",12:"\u4e3b\u8513\u957f",17:"\u682a\u9ad8"},b=trees[a],c;c="";switch(b.state){case 2:c='<span class="renzheng">\u5df2\u8ba4\u8bc1</span>';break;case 3:c='<span class="qjd">\u65d7\u8230\u5e97</span>';break;case 4:c='<span class="qjd">\u5355\u54c1\u738b</span>'}c=""+('<div class="header"><a class="back" href="javascript:closetree()">\u8fd4\u56de</a>'+('<a class="poi" href="http://apis.map.qq.com/uri/v1/marker?marker=coord:'+b.x+","+b.y+";title:"+b.username+" "+b.name+";addr:"+b.address+'&referer=geo"> </a>')+c+(0<b.collections?'<span class="cangmi">\u85cf\u7c73'+b.collections+"</span>":"")+"</div>")+"<table>";c+='<tr><th colspan="2">'+b.name+"</th></tr>";b.ldname&&(c+='<tr><td class="ldname" colspan="2">'+b.ldname+"</td></tr>");b.invoice&&(c+='<img class="fapiao" src="/img/fapiao.png?t=2">');101!=b.type&&(c+='<tr><td class="field">\u4e0a\u8f66\u5355\u4ef7\uff1a</td><td class="price">'+b.price+"</td></th>");c=b.qrcodeid?c+('<tr><td class="field">\u6811\u724c\uff1a</td><td>'+b.qrcodeid+"</td>"):c+('<tr><td class="field">\u7f16\u53f7\uff1a</td><td>'+b.treeid+"</td>");b.dbh&&(c+='<tr><td class="field">'+(b.dbh_type?d[b.dbh_type]:"\u80f8\u5f84")+"\uff1a</td><td>"+b.dbh+"\u516c\u5206</td>");b.age&&(c+='<tr><td class="field">\u82d7\u9f84\uff1a</td><td>'+b.age+"\u5e74</td>");b.crownwidth&&(c+='<tr><td class="field">\u51a0\u5e45\uff1a</td><td>'+mORcm(b.crownwidth)+"</td>");b.height&&(c+='<tr><td class="field">'+(b.height_type?d[b.height_type]:"\u682a\u9ad8")+"\uff1a</td><td>"+mORcm(b.height)+"</td>");b.branch_point_height&&(c+='<tr><td class="field">\u5206\u679d\u70b9\u9ad8\uff1a</td><td>'+mORcm(b.branch_point_height)+"</td>");b.branch_bough_number&&(c+='<tr><td class="field">\u5206\u679d\u6570\uff1a</td><td>'+b.branch_bough_number+"\u4e2a</td>");b.substrate&&(c+='<tr><td class="field">\u57fa\u8d28\uff1a</td><td>'+b.substrate+"</td>");b.remark&&(c+='<tr><td class="field">\u5907\u6ce8\uff1a</td><td>'+b.remark+"</td>");101!=b.type&&(c+='<tr><td class="field">\u6570\u91cf\uff1a</td><td>'+b.count+b.unit+"</td>");c+='<tr><td class="field">\u4f4d\u7f6e\uff1a</td><td>'+b.province+" "+b.district+"</td>";c+='<tr><td class="field">\u82d7\u5546\uff1a</td><td>'+b.username+"</td>";c+='<tr><td class="field">\u8054\u7cfb\u7535\u8bdd\uff1a</td><td><a href="tel:'+b.userphone+'">'+b.userphone+"</a></td>";c+='<tr><td class="field">\u53d1\u5e03\u65f6\u95f4\uff1a</td><td>'+b.time+"</td>";c+="</table>";b.video&&(c+='<video onplay="playVideo()" preload="none" controls="controls" poster="/trees/video/'+b.video+'.jpg" width="100%" webkit-playsinline><source src="/trees/video/'+b.video+'.mp4" type="video/mp4" /></video></div>');for(var e in b.imgpath)b.phototime&&b.phototime[e]&&(c+='<div style="text-align:center;">'),c+='<a href="javascript:sildeTreeImage('+a+","+e+')"><img src="trees/o2/'+b.imgpath[e]+'" /></a>',b.phototime&&b.phototime[e]&&(c+='<br><a class="poi2" href="http://apis.map.qq.com/uri/v1/marker?marker=coord:'+b.photogps[e]+";title:"+b.username+b.name+";addr:"+b.address+'&referer=geo"></a><div class="phototime">'+b.phototime[e]+"</div></div>"),c+="</div>";user&&(c+='<button onclick="addMyTree('+a+')">\u52a0\u5165\u627e\u6811\u8f66</button>',user&&user.istrader&&(c+=4!=b.state?'<button onclick="authenticateTree('+a+')">\u5355\u54c1\u8ba4\u8bc1</button>':'<button onclick="decertificationTree('+a+')">\u53d6\u6d88\u8ba4\u8bc1</button>'));c+='<button onclick="gotoShop('+b.shopid+')">\u8fdb\u5165\u4ed6\u7684\u82d7\u5e97</button>';scrollTop=document.body.scrollTop;$("#filter").hide();$("#treelist").hide();$("#footer").hide();document.body.scrollTop=0;a=document.createElement("div");a.id="treeview";a.innerHTML=c;document.body.appendChild(a);user&&user.shopid==b.shopid||$.post("/com/accesstree.php",{type:0,treeid:b.treeid,shopid:b.shopid,userid:user?user.userid:0})}function sildeTreeImage(a,d){var b=trees[a],c='<div class="bd"><ul>',e;for(e in b.imgpath)c+='<li><img onclick="closeImageView()" src="trees/o2/'+b.imgpath[e]+'"/>',c+="<span>"+b.name+"\u00a5"+b.price+" "+b.count+b.unit+" "+b.province+b.district+"<br>"+attribute(b)+"</span>",user&&(c+='<i onclick="addMyTree('+a+')">\u2661</i>'),c+="</li>";c+='</ul></div><div class="hd"><ul></ul></div>';scrollTopTreeView=document.body.scrollTop;$("#treeview").hide();document.body.scrollTop=0;a=document.createElement("a");a.className="slideBox";a.id="imageview";a.innerHTML=c;document.body.appendChild(a);TouchSlide({slideCell:"#imageview",titCell:".hd ul",mainCell:".bd ul",effect:"left",defaultIndex:d,delayTime:500,interTime:3500,autoPage:!0,autoPlay:!0});d=document.getElementById("imageview").querySelector(".bd").querySelectorAll("li");for(a=d.length-1;0<=a;a--)c=d[a],c.style.height=document.body.scrollHeight+"px",c.style.verticalAlign="middle"}function closeImageView(){$("#treeview").show();$("#imageview").remove();document.body.scrollTop=scrollTopTreeView}function closetree(){$("#treeview").remove();$("#filter").show();$("#treelist").show();$("#footer").show();document.body.scrollTop=scrollTop}function addMyTree(a){a=trees[a];$.post("com/addmytree.php?userid="+user.userid+"&treeid="+a.treeid+"&shopid="+a.userid+(user&&user.shopid==a.shopid?"&isOwn=1":""),function(){alert("\u52a0\u5165\u6210\u529f\uff01")})}function authenticateTree(a){$.post("com/authenticatetree.php?userid="+user.userid+"&state=2&treeid="+trees[a].treeid,function(){trees[a].state=2;alert("\u8ba4\u8bc1\u6210\u529f\uff01")})}function decertificationTree(a){$.post("com/authenticatetree.php?userid="+user.userid+"&state=1&treeid="+trees[a].treeid,function(){trees[a].state=1;alert("\u5df2\u53d6\u6d88\u8ba4\u8bc1\uff01")})}function onSearch(a){a||(a=$.trim($("#key").val()));a&&(window.isHome?($("#where").html(""),$("#spec_dbh").val(""),$("#spec_crownwidth").val(""),$("#spec_height").val(""),$("#btn_price").html("\u4ef7\u683c\u25c7"),$("#btn_price").attr("class","unselect"),$("#btn_renzheng").attr("class","unselect"),$("#btn_yuantu").attr("class","unselect"),$("#btn_shipin").attr("class","unselect"),searchKey(a),$("#key").blur(),0<$("#userlist").length&&($("#userlist").hide(),$("#treelist").show(),$("#footer").show()),$("#tree").is(":hidden")&&showTree()):location.href="index.html?key="+a)}function gotoShop(a){window.location="shop.php?userid="+a}function checkUser(){(user=getcookie("user2"))&&(user=JSON.parse(user))}checkUser();$(function(){loadJS("/js/fastclick.min.js?t=20161205");$("#key").keydown(function(a){13!=a.keyCode||isLoading||onSearch()});user&&($("#footer_menu").show(),$.get("/com/count.cart.php",{userid:user.userid},function(a){$("#nav_cart i").html("<span>"+a+"</span>")}),$("#nav_cart").attr("href","cart.php?userid="+user.userid),$("#nav_shop").attr("href","shop.php?userid="+user.userid),$("#headImage").html('<img src="headimg/96/'+user.userid+'.jpg">'));0<navigator.userAgent.indexOf("MicroMessenger")&&loadJS("/js/wechat.js?t=201801022")});(function(){var a=!1,d,b;$("#content").on("touchstart",function(a){d=(new Date).getTime();b=a.targetTouches[0].clientY});$("#content").on("touchmove",function(c){c=b-c.changedTouches[0].clientY;0<c?a||(a=!0,$("#header_bar").css("top","-50px"),$("#footer_menu").css("bottom","-50px")):(a&&(a=!1,$("#header_bar").css("top","0"),$("#footer_menu").css("bottom","0")),-1.2>c/((new Date).getTime()-d)&&$(document).scrollTop(0))})})();